<!-- page de garde -->
<div id="notif-div"></div>

<!-- Register page -->
<div id="classroom-register-container" style="display:none;">
    <div class="inner-register-container">
        <form action="#" id="create-teacher-account-and-link-to-group-form">
            <div class="form-group part-content-index part-row c-primary-form row">

                <div class="col-md-12">
                    <h3 class="font-weight-bold green-vitta text-center mb-4 text-uppercase"
                        data-i18n="classroom.login.register.title"></h3>
                    <p class="text-center" data-i18n="classroom.login.register.description"></p>
                </div>

                <div class="col-md-6">
                    <div class="form-row mb-4">
                        <img src="assets/media/green_user.png" class="icon-label">
                        <label for="profile-form-first-name" class="tutorial-label"
                            data-i18n="classroom.profil.accountSettings.firstname"></label>
                        <span class="text-danger"> *</span>
                        <input type="text" name="first-name" id="profile-form-first-name"
                            class="form-control form-control-lg">
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-row mb-4">
                        <img src="assets/media/green_user.png" class="icon-label">
                        <label for="profile-form-last-name" class="tutorial-label"
                            data-i18n="classroom.profil.accountSettings.lastname"></label>
                        <span class="text-danger"> *</span>
                        <input type="text" name="last-name" id="profile-form-last-name"
                            class="form-control form-control-lg">
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="form-row mb-4">
                        <img src="assets/media/green_user.png" class="icon-label">
                        <label for="profile-form-pseudo" class="tutorial-label"
                            data-i18n="classroom.profil.accountSettings.nickname"></label>
                        <span class="text-danger"> *</span>
                        <input type="text" name="pseudo" id="profile-form-pseudo" class="form-control form-control-lg">
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="form-row mb-4">
                        <img src="assets/media/green_user.png" class="icon-label">
                        <label for="profile-form-email" class="tutorial-label"
                            data-i18n="classroom.profil.accountSettings.email"></label>
                        <span class="text-danger"> *</span>
                        <input type="email" name="email" id="profile-form-email" class="form-control form-control-lg">
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="form-row mb-4">
                        <img src="assets/media/green_user.png" class="icon-label">
                        <label for="profile-form-phone" class="tutorial-label"
                            data-i18n="superadmin.group.join.phone"></label>
                        <input type="text" name="phone-number" class="form-control form-control-lg"
                            id="profile-form-phone" class="form-control form-control-lg">
                    </div>
                </div>

                <div class="col-md-12">
                    <div class="form-row mb-4">
                        <img src="assets/media/green_user.png" class="icon-label">
                        <label for="profile-form-bio" class="tutorial-label">Bio <span
                                class="text-danger">*</span></label>
                        <textarea class="form-control form-control-lg" name="mini-bio" id="profile-form-bio"
                            rows="3"></textarea>
                    </div>
                </div>

                <div class="col-md-12">
                    <div class="form-row mb-4">
                        <img src="assets/media/green_lock.png" class="icon-label">
                        <label for="profile-form-school" class="tutorial-label"
                            data-i18n="superadmin.group.join.school"></label>
                        <span class="text-danger"> *</span>
                        <input type="text" class="form-control form-control-lg" name="school" id="profile-form-school">
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-row mb-4">
                        <img src="assets/media/green_user.png" class="icon-label">
                        <label for="profile-form-grade" class="tutorial-label"
                            data-i18n="superadmin.group.join.grade"></label>
                        <span class="text-danger"> *</span>
                        <select class="form-control" id="profile-form-grade" name="grade">
                            <option selected value="0">Primaire</option>
                            <option value="1">Collège</option>
                            <option value="2">Lycée</option>
                            <option value="3">Lycée Professionel</option>
                            <option value="4">POST-BAC</option>
                        </select>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-row mb-4">
                        <img src="assets/media/green_user.png" class="icon-label">
                        <label for="profile-form-subject" class="tutorial-label"
                            data-i18n="superadmin.group.join.subject"></label>
                        <span class="text-danger"> *</span>
                        <select class="form-control" id="profile-form-subject" name="subject">
                        </select>
                    </div>
                </div>

                <div class="col-md-6">
                    <div>
                        <img src="assets/media/green_lock.png" class="icon-label">
                        <span class="text-danger"> *</span>
                        <label for="profile-form-password" class="tutorial-label"
                            data-i18n="classroom.profil.accountSettings.password"></label>
                    </div>
                    <div class="form-inline">
                        <input type="password" name="password" id="profile-form-password"
                            class="form-control form-control-lg">
                        <i class="classroom-clickable fas fa-low-vision ml-2 password-display-toggler"></i>
                        <p class="font-italic ml-2" data-i18n="classroom.login.register.passwordConstraints"></p>
                    </div>
                </div>

                <div class="col-md-6">
                    <img src="assets/media/green_lock.png" class="icon-label">
                    <span class="text-danger"> *</span>
                    <label for="profile-form-confirm-password" class="tutorial-label"
                        data-i18n="classroom.profil.accountSettings.confirmPassword"></label>
                    <div class="form-inline">

                        <input type="password" name="confirm-password" id="profile-form-confirm-password"
                            class="form-control form-control-lg">
                        <i class="classroom-clickable fas fa-low-vision ml-2 password-display-toggler"></i>
                    </div>
                </div>
            </div>


            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="cb_name_public">
                <label class="form-check-label" for="cb_name_public">
                    Acceptez-vous que votre nom et prénom soient publics sur le site ?
                </label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="cb_newsletter">
                <label class="form-check-label" for="cb_newsletter">
                    Souhaitez-vous recevoir notre newsletter par mail ?
                </label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="cb_alert_mail">
                <label class="form-check-label" for="cb_alert_mail">
                    Souhaitez-vous recevoir des alertes par mail lors de la réception de nouveaux messages sur le site ?
                </label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="cb_allow_contact">
                <label class="form-check-label" for="cb_allow_contact">
                    Souhaitez-vous pouvoir être contacté par les autres utilisateurs du site ?
                </label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="cb_adult" required>
                <label class="form-check-label" for="cb_adult">
                    Je confirme avoir plus de 18 ans (article 1124 du code civil)*
                </label>
            </div>

            <div class="col-md-12 d-flex flex-column align-items-center">
                <input class="btn c-btn-secondary m-3" type="submit" data-i18n="[value]classroom.login.signup">
            </div>

            <p>Vittascience place la sécurité et la confidentialité des données personnelles de ses utilisateurs au
                coeur
                de ses préoccupations. Découvrez<a href="http://vittascience.com/privacy"> notre politique de protection
                    des données personnelles</a> </p>
            <p>Les champs marqués par un <span class="text-danger">*</span> sont obligatoires.</p>
            <p>En validant ce formulaire, vous acceptez les <a href="http://vittascience.com/"> conditions
                    générales d'utilisation</a>.</p>
        </form>
        <button onclick="returnToConnectionPanel('#classroom-login-container-bis')"
            class="btn close-login-classroom mt-3 mr-3">
            <i class="fas fa-times"></i>
        </button>
    </div>
</div>


<!-- page de login via un lien -->
<div id="classroom-login-container-bis" style="display:none;">
    <div id="info-box"></div>
    <div class="inner-login-container">
        <p id="classroom-desc"></p>
        <div id="classroom-create-account" class="container-border-left container-border-left-enable">
            <h3 class="font-weight-bold green-vitta" data-i18n="classroom.login.signup"></h3>
            <div class="c-primary-form">
                <p data-i18n="superadmin.group.join.firstVisit"></p>
            </div>
            <button class="btn c-btn-primary" id="register-new-teacher" type="submit"><span
                    data-i18n="classroom.login.signup"></span> <i class="fas fa-chevron-right"></i></button>
            <span id="warning-pseudo-used" style="display:none;" data-i18n="classroom.login.error.used"></span>
        </div>
        <div id="classroom-login-account" class="container-border-right">
            <div class="c-primary-form">
                <h3 class="font-weight-bold green-vitta" data-i18n="classroom.login.signin"></h3>
                <p data-i18n="superadmin.group.join.signinSubtitle"></p>

                <img src="assets/media/green_user.png" class="icon-label">
                <label for="username" data-i18n="superadmin.group.join.addressMail"></label></br>
                <input type="text" placeholder="exemple@domaine.com" id="user-pseudo-form" name="secret_code"
                    autocomplete="off" required></br>

                <img src="assets/media/green_lock.png" class="icon-label">
                <label for="username" data-i18n="words.password"></label></br>
                <input type="password" placeholder="••••••••••" name="secret_code" id="user-password-form"
                    autocomplete="off" required></br>
                <a href="#" data-i18n="classroom.login.forgot"></a></br>
                <span class="mt-2 mb-2 alert alert-warning mismatched-login" style="display:none;"
                    data-i18n="classroom.login.error.badInput"></span>
            </div>
            <button class="btn c-btn-primary" id="connect-teacher"><span
                    data-i18n="superadmin.group.join.signin"></span> <i class="fas fa-chevron-right"></i></button>
        </div>
        <!-- <button onclick="returnToConnectionPanel('#classroom-login-container-bis')" class="btn close-login-classroom"><i
                class="fas fa-times"></i></button> -->
    </div>
</div>

<!-- Ecran de notification de liaison réussie -->
<div id="group-joinded-container" style="display:none;">
    <div class="inner-login-container">
        <div class="col-12">
            <h3 class="font-weight-bold green-vitta m-auto text-center">Vous avez rejoint le groupe
                "<span id="gourpName"></span>" !</h3>
            <p class="text-center">Vous allez être redirigé vers la page d'accueil.</p>
        </div>
        <button onclick="returnToConnectionPanel('#classroom-login-container-bis')" class="btn close-login-classroom"><i
                class="fas fa-times"></i></button>
    </div>
</div>

<!-- Ecran de réuissite d'inscription -->
<div id="registration-successful" style="display:none;">
    <div class="inner-login-container">
        <div class="col-12">
            <h3 class="font-weight-bold green-vitta m-auto text-center">Inscription réussie !</h3>
            <p class="text-center">
                <p class="text-center">Un e-mail vient de vous être envoyé, suivez le lien dans celui-ci pour activer
                    votre compte et continuez votre liaison au groupe "<span id="gourpName2"></span>"</p>
        </div>
        <button onclick="returnToConnectionPanel('#classroom-login-container-bis')" class="btn close-login-classroom"><i
                class="fas fa-times"></i></button>
    </div>
</div>

<!-- Ecran de lien invalide -->
<div id="invalid-link" style="display:none;">
    <div class="inner-login-container">
        <div class="col-12">
            <h3 class="font-weight-bold green-vitta m-auto text-center">Lien invalide !</h3>
            <p class="text-center">Le format du lien que vous avez entré ne correspond pas.</p>
        </div>
        <button onclick="returnToConnectionPanel('#classroom-login-container-bis')" class="btn close-login-classroom"><i
                class="fas fa-times"></i></button>
    </div>
</div>

<!-- Ecran de confirmation d'activation de compte -->
<div id="account-activated" style="display:none;">
    <div class="inner-login-container">
        <div class="col-12">
            <h3 class="font-weight-bold green-vitta m-auto text-center">Votre compte à bien été activé !</h3>
            <p class="text-center">Vous allez être redirigé vers la page d'accueil.</p>
        </div>
        <button onclick="returnToConnectionPanel('#classroom-login-container-bis')" class="btn close-login-classroom"><i
                class="fas fa-times"></i></button>
    </div>
</div>

<!-- Ecran de groupe introuvable -->
<div id="group-not-found" style="display:none;">
    <div class="inner-login-container">
        <div class="col-12">
            <h3 class="font-weight-bold green-vitta m-auto text-center">Groupe introuvable !</h3>
            <p class="text-center">Nous ne trouvons aucun groupe lié au lien <span id="gourpName3"></span></p>.</p>
        </div>
        <button onclick="returnToConnectionPanel('#classroom-login-container-bis')" class="btn close-login-classroom"><i
                class="fas fa-times"></i></button>
    </div>
</div>

<!-- Ecran de confimation de liaison -->
<div id="confirm-link-to-group" style="display:none;">
    <div class="inner-login-container">
        <div class="col-12">
            <h3 class="font-weight-bold green-vitta m-auto text-center">Vous vous apprêtez à rejoindre le groupe "<span
                    id="groupNameConfirmLink"></span>"</h3>
            <p class="text-center">Il ne reste plus qu'une étape ! Cliquez sur le bouton si dessous pour finaliser la
                liaison.</p>
        </div>
        <button class="btn browse-button mx-auto mt-3 btn-lg" onclick="linkTeacherToGroupProcess()">Rejoindre</button>
        <button onclick="returnToConnectionPanel('#classroom-login-container-bis')" class="btn close-login-classroom"><i
                class="fas fa-times"></i></button>
    </div>
</div>

<!-- Ecran de notification d'utilisateur déjà actif -->
<div id="already-active" style="display:none;">
    <div class="inner-login-container">
        <div class="col-12">
            <h3 class="font-weight-bold green-vitta m-auto text-center">Votre compte est déjà actif.</h3>
            <p class="text-center">Vous allez être redirigé vers la page de connexion.</p>
        </div>
        <button onclick="returnToConnectionPanel('#classroom-login-container-bis')" class="btn close-login-classroom"><i
                class="fas fa-times"></i></button>
    </div>
</div>

<!-- Ecran de notification d'utilisateur déjà lié au groupe -->
<div id="already-linked" style="display:none;">
    <div class="inner-login-container">
        <div class="col-12">
            <h3 class="font-weight-bold green-vitta m-auto text-center">Vous faites déjà partie de ce groupe.</h3>
            <p class="text-center">Vous allez être redirigé vers l'accueil.</p>
        </div>
        <button onclick="returnToConnectionPanel('#classroom-login-container-bis')" class="btn close-login-classroom"><i
                class="fas fa-times"></i></button>
    </div>
</div>

<!-- Ecran de notification d'utilisateur introuvable -->
<div id="no-teacher" style="display:none;">
    <div class="inner-login-container">
        <div class="col-12">
            <h3 class="font-weight-bold green-vitta m-auto text-center">Une erreur est survenue lors de la liaison.</h3>
            <p class="text-center">L'utilisateur n'a pas été trouvé, vous allez être redirigé vers la page de login.</p>
            <p class="text-center">Si le problème persiste contactez l'administration.</p>
        </div>
        <button onclick="returnToConnectionPanel('#classroom-login-container-bis')" class="btn close-login-classroom"><i
                class="fas fa-times"></i></button>
    </div>
</div>


<div id="login-container" style="display:none;position:relative;">
    <div class="login-form" id="signupin-div">
        <h1><span class="fa fa-sign-in-alt"></span><span data-i18n="login_popup.title"></span> <button
                onclick="returnToConnectionPanel('#login-container')" class="btn close-login-classroom"><i
                    class="fas fa-times"></i></button></h1>

        <p data-i18n="login_popup.details"></p>
        <p><a data-i18n="login-page.createAccount" href='#' onclick="displaySignupClass();"></a></p>
        <div id="info-div">

        </div>
        <form id="login-form">
            <label for="login-mail-input">
                <span class="fa fa-at"></span> <span data-i18n="login_popup.form.addressmail"></span><span
                    class="mandatory">*</span>
            </label>
            <input name='mail' style="margin-bottom:5px;"
                data-i18n="[placeholder]login_popup.form.addressmail_placeholder" class="form-control" type="email"
                id="login-mail-input">

            <label for="login-pwd-input">
                <span class="fa fa-key"></span> <span data-i18n="login_popup.form.password"></span><span
                    class="mandatory">*</span>
            </label>
            <input name='password' data-i18n="[placeholder]login_popup.form.password_placeholder" class="form-control"
                type="password" id="login-pwd-input">

            <input type="text" name="za78e-username" autocomplete="off" value="" id="za78e-username" class="za78e-field"
                placeholder="za78e username" />
            <input type="number" name="za78e-number" autocomplete="off" max="10" min="0" id="za78e-number"
                class="za78e-field" placeholder="za78e number" />

            <div>
                <a class="hint" href="/passwordRecovery" data-i18n="login_popup.form.forgot_password"></a>
            </div>
            <button type='button' style="margin-top:10px;" onclick="checkLoginTeacher();" class="btn vitta-button"
                id="login-button" data-i18n="login_popup.form.btn_connect"></button>
        </form>
    </div>
</div>

<script>
    /* INTERACTIVE BLOCK */
    $("#fake-blockly-input").on("input", (function () {
        var text = $("#fake-blockly-input").val().trim();

        /*
        if (text == null || text == '') {
            text = 'Bonjour !';
            $("#fake-blockly-input").val(text)
        }
        */

        $('#fake-code-text').html('\'' + text + '\'');
        $('#fake-display').html(text);
    }));
</script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous">
</script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
    integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous">
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/i18next/8.1.0/i18next.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-i18next/1.2.1/jquery-i18next.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/i18next-xhr-backend/1.5.1/i18nextXHRBackend.min.js"></script>
<script
    src="https://cdnjs.cloudflare.com/ajax/libs/i18next-browser-languagedetector/2.2.3/i18nextBrowserLanguageDetector.min.js">
</script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
<script src="assets/js/utils/translate.js"></script>
<script src="assets/js/utils/get.js"></script>
<script src="assets/js/scripts/dashboardActivities.js"></script>
<script src="assets/js/scripts/displayPanel.js"></script>
<script src="assets/js/lib/EasyAutocomplete-1.3.5/jquery.easy-autocomplete.min.js"></script>
<script src="assets/js/scripts/signup.js"></script>
<script src="assets/js/main/Loader.js"></script>
<script src="assets/js/main/UIManager.js"></script>
<script src="assets/js/main/User.js"></script>
<script src="assets/js/main/ClassroomManager.js"></script>
<script src="assets/js/main/Main.js"></script>
<script src="assets/js/scripts/main-login.js"></script>
<script src="assets/js/scripts/login.js"></script>
<script src="assets/js/scripts/buttons.js"></script>
<script>
    UIManager.init().then((resolve) => {
        UserManager.init().then((resolve) => {

                Main.init().then((resolve) => {
                    loginFaqNeutral();
                    /* FAQ BOXES */
                    var headers = document.getElementsByClassName("faq-box-header");
                    $(headers).rotate({
                        bind: {
                            click: function () {
                                var drop = $(this).find(".faq-box-dropdown");
                                var content = $(this).parent().find(".faq-box-content");
                                if (drop.hasClass("dropped")) {
                                    drop.rotate({
                                        angle: drop.getRotateAngle(),
                                        animateTo: 0
                                    });
                                    content.fadeOut("slow", function () {
                                        drop.removeClass("dropped");
                                    });
                                } else {
                                    drop.rotate({
                                        angle: drop.getRotateAngle(),
                                        animateTo: 90
                                    });
                                    content.fadeIn("slow", function () {
                                        drop.addClass("dropped");
                                    });
                                }
                            }
                        }
                    });
                    if ($_GET('link')) {
                        findClassroomToConnect($_GET('link'))
                    }
                })
            },
            (reason) => {
                console.log("UserManager failed to load: " + reason);
                failedToLoad();
            }
        );
    })
</script>

<script>
    if ($_GET('page')) {
        let page = $_GET('page');
        switch (page) {
            case 'registration':
                $("#classroom-register-container").toggle();
                break;
            case 'confirmation':
                $("#account-activated").toggle();
                setTimeout(() => {
                    document.location = urlWithCode + "&page=login";
                }, 1500);
                break;
            case 'login':
                $('#classroom-login-container-bis').toggle();
                $('#classroom-desc').text(groupName);
                $("#classroom-create-account").toggle();
                break;
            case 'badlink':
                $('#group-not-found').toggle();
                $('#gourpName3').text(linkCode);
                break;
            case 'invalidlink':
                $('#invalid-link').toggle();
                break;
            case 'confirm':
                $('#confirm-link-to-group').toggle();
                $('#groupNameConfirmLink').text(groupName);
                break;
            case 'success':
                $('#group-joinded-container').toggle();
                $('#gourpName').text(groupName);
                setTimeout(() => {
                    document.location = urlHome;
                }, 2500);
                break;
            case 'alreadyactive':
                $('#already-active').toggle();
                setTimeout(() => {
                    document.location = urlWithCode + "&page=login";
                }, 2500);
                break;
            case 'alreadylinked':
                $('#already-linked').toggle();
                setTimeout(() => {
                    document.location = urlHome;
                }, 2500);
                break;
            case 'noteacher':
                $('#no-teacher').toggle();
                setTimeout(() => {
                    document.location = urlWithCode + "&page=login";
                }, 2500);
                break;
            default:
                break;
        }
    } else {
        $('#classroom-login-container-bis').toggle();
        $('#classroom-desc').text(groupName);
    }

    //$('#group-name').text(groupName);

    /**
     * login a user
     * @param {FormData}  
     * @return {Classroom} 
     */
    function loginTeacher(payload) {
        return new Promise(function (resolve, reject) {
            $.ajax({
                type: "POST",
                url: "/routing/Routing.php?controller=user&action=login",
                data: payload,
                success: function (response) {
                    resolve(JSON.parse(response))
                },
                error: function () {
                    reject();
                }
            });
        })
    }

    $('#connect-teacher').click(function () {
        checkLoginTeacher();
    })

    function checkLoginTeacher() {
        let form = {
            'mail': $('#user-pseudo-form').val(),
            'password': $('#user-password-form').val()
        }

        loginTeacher(form).then(function (response) {
            if (response.success === true) {
                setTimeout(function () {
                    document.location = urlWithCode + "&page=confirm";
                }, 2500);
            } else {
                var infoBox = document.getElementById("info-box");
                infoBox = document.createElement("div");
                infoBox.className = "alert alert-danger";
                if (response.success == false) {
                    infoBox.innerHTML = i18next.t('login_popup.error');
                } else {
                    infoBox.innerHTML = i18next.t('login_popup.errorBeta');
                }
                document.getElementById("info-div").innerHTML = "";
                document.getElementById("info-div").style.display = "none";
                document.getElementById("info-div").appendChild(infoBox);
                $("#info-div").fadeIn("slow");
            }
        })
    }

    $('#register-new-teacher').click(() => {
        $('#classroom-register-container').toggle();
        $('#classroom-login-container-bis').toggle();
    })

    /**
     * Create teacher form submit listener
     */
    document.getElementById('create-teacher-account-and-link-to-group-form').addEventListener('submit', (e) => {
        e.preventDefault();
        let data = new FormData(e.target);
        if (teacherAccountCreateFormCheckv2(data)) {
            createTeacherAccountv2(data).then((response) => {
                if (response.isUserAdded) {
                    document.getElementById('profile-form-password').value = '';
                    document.getElementById('profile-form-confirm-password').value = '';
                    displayNotification('#notif-div', "classroom.notif.accountCreated", "success");
                    $("#registration-successful").toggle();
                    $("#classroom-register-container").toggle();
                    $('#gourpName2').text(groupName);
                } else {
                    if (response.errorType) {
                        switch (response.errorType) {
                            case 'unknownUser':
                                displayNotification('#notif-div', "classroom.notif.unknownUser",
                                    "error");
                                break;
                            default:
                                break;
                        }
                    }
                    if (response.errors) {
                        for (let error in response.errors) {
                            displayNotification('#notif-div', `classroom.notif.${error}`, "error");
                        }
                    }
                }
            });
        }
    });

    /**
     * Create teacher account (registration)
     */
    function createTeacherAccountv2(formData) {
        return new Promise((resolve, reject) => {
            $.ajax({
                type: 'POST',
                url: '/routing/Routing.php?controller=groupadmin&action=registerTeacher',
                data: {
                    'firstname': formData.get('first-name'),
                    'surname': formData.get('last-name'),
                    'pseudo': formData.get('nickname'),
                    'email': formData.get('email'),
                    'password': formData.get('password'),
                    'password_confirm': formData.get('confirm-password'),
                    'bio': formData.get('mini-bio'),
                    'pseudo': formData.get('pseudo'),
                    'phone': formData.get('phone-number'),
                    'school': formData.get('school'),
                    'grade': parseInt(formData.get('grade')) + 1,
                    'subject': parseInt(formData.get('subject')) + 1,
                    'newsletter': $('#cb_newsletter').is(':checked'),
                    'private': $('#cb_name_public').is(':checked'),
                    'mailmessage': $('#cb_alert_mail').is(':checked'),
                    'contact': $('#cb_allow_contact').is(':checked'),
                    'gcode': $_GET('gc')
                },
                success: function (response) {
                    resolve(JSON.parse(response));
                },
                error: function () {
                    reject();
                }
            });
        });
    }


    /**
     * Link the teacher to the group
     */
    function linkTeacherToGroup(user, group) {
        return new Promise((resolve, reject) => {
            $.ajax({
                type: 'POST',
                url: '/routing/Routing.php?controller=groupadmin&action=linkTeacherToGroup',
                data: {
                    'user_id': user,
                    'group_id': group
                },
                success: function (response) {
                    resolve(JSON.parse(response));
                },
                error: function () {
                    reject();
                }
            });
        });
    }

    function linkTeacherToGroupProcess() {
        linkTeacherToGroup(user_id, group_id).then((response) => {
            setTimeout(function () {
                document.location = urlWithCode + `&page=${response.message}`;
            }, 2500);
        })
    }


    /**
     * Check if the teacher's account update form values are correct
     * @returns {boolean} - true if check ok, false otherwise
     */
    function teacherAccountCreateFormCheckv2(formData) {

        let formValues = {
                'firstname': {
                    value: formData.get('first-name'),
                    id: 'profile-form-first-name'
                },
                'surname': {
                    value: formData.get('last-name'),
                    id: 'profile-form-last-name'
                },
                'email': {
                    value: formData.get('email'),
                    id: 'profile-form-email'
                },
                'password': {
                    value: formData.get('password'),
                    id: 'profile-form-password'
                },
                'confirmPassword': {
                    value: formData.get('confirm-password'),
                    id: 'profile-form-confirm-password'
                },
                'bio': {
                    value: formData.get('mini-bio'),
                    id: 'profile-form-bio'
                },
                'phone': {
                    value: formData.get('phone-number'),
                    id: 'profile-form-phone'
                },
                'school': {
                    value: formData.get('school'),
                    id: 'profile-form-school'
                },
                'grade': {
                    value: formData.get('grade'),
                    id: 'profile-form-grade'
                },
                'subject': {
                    value: formData.get('subject'),
                    id: 'profile-form-subject'
                }
            },
            errors = [];

        console.log(formValues);
        for (let input in formValues) {
            let currentElt = document.getElementById(formValues[input].id);
            if (currentElt.classList.contains('form-input-error')) {
                currentElt.classList.remove('form-input-error');
            }
        }

        if (formValues.firstname.value.length < 2) {
            errors.push('firstNameTooShort');
            showFormInputError(formValues.firstname.id);
        }

        if (formValues.surname.value.length < 2) {
            errors.push('lastNameTooShort');
            showFormInputError(formValues.surname.id);
        }

        if (!formValues.email.value.match(
                /[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/
            )) {
            errors.push('invalidEmail');
            showFormInputError(formValues.email.id);
        }

        if (!formValues.password.value.length > 7) {
            errors.push('invalidPassword');
            showFormInputError(formValues.password.id);
        }

        if (formValues.password.value != formValues.confirmPassword.value) {
            errors.push('passwordAndConfirmMismatch');
            showFormInputError(formValues.password.id);
            showFormInputError(formValues.confirmPassword.id);
        }


        if (errors.length) {
            for (let error of errors) {
                displayNotification('#notif-div', `classroom.notif.${error}`, "error");
            }
            return false;
        } else {
            return true;
        }
    }

    /**
     * Add the error class on input form
     * @param {string} id - the id of the form input
     */
    function showFormInputError(id) {
        document.getElementById(id).classList.add('form-input-error');
    }

    // Grade select gestion
    $('#profile-form-grade').change(() => {
        switch ($('#profile-form-grade').val()) {
            case "0":
                createSubjectSelectTeacherForm(FirstGradeSubjects);
                break;
            case "1":
                createSubjectSelectTeacherForm(SecondGradeSubjects);
                break;
            case "2":
                createSubjectSelectTeacherForm(ThirdGradeSubjects);
                break;
            case "3":
                createSubjectSelectTeacherForm(FourthGradeSubjects);
                break;
            case "4":
                createSubjectSelectTeacherForm(FithGradeSubjects);
                break;
            default:
                break;
        }
    })

    function createSubjectSelectTeacherForm(array) {
        $("#profile-form-subject").empty();
        for (let index = 0; index < array.length; index++) {
            const o = new Option(array[index], index);
            $(o).html(array[index]);
            $("#profile-form-subject").append(o);
        }
    }
    createSubjectSelectTeacherForm(FirstGradeSubjects);
</script>